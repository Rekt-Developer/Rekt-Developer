name: 🚀 Advanced Profile Generation & Automation

on:
  schedule:
    - cron: "0 */8 * * *"  # Run every 8 hours
  workflow_dispatch:
  push:
    branches:
      - main

env:
  METRICS_TOKEN: ${{ secrets.METRICS_TOKEN }}
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  generate-metrics:
    name: 📊 Generate Comprehensive Metrics
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: 🔍 Checkout Repository
        uses: actions/checkout@v4

      - name: 📊 Generate Profile Metrics
        uses: lowlighter/metrics@latest
        with:
          token: ${{ env.METRICS_TOKEN }}
          user: likhonisaac
          base: |
            header
            activity
            community
            repositories
            metadata
          plugin_languages: yes
          plugin_languages_indepth: yes
          plugin_languages_details: lines, percentage, bytes
          plugin_habits: yes
          plugin_achievements: yes
          plugin_isocalendar: yes

  generate-animations:
    name: 🎨 Generate Animations & Visuals
    runs-on: ubuntu-latest
    steps:
      - name: 🐍 Snake Animation
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: likhonisaac
          outputs: |
            dist/snake-dark.svg
            dist/snake-light.svg
        env:
          GITHUB_TOKEN: ${{ env.GH_TOKEN }}

      - name: 📈 3D Contribution Graph
        uses: yoshi389111/github-profile-3d-contrib@0.7.1
        with:
          USERNAME: likhonisaac
        env:
          GITHUB_TOKEN: ${{ env.GH_TOKEN }}

      - name: 📷 Generate Profile Banner
        uses: actions/checkout@v4
        with:
          ref: banner-generation
          fetch-depth: 0

      - name: 🖼️ Create Dynamic Banner
        run: |
          mkdir -p banners
          convert -size 1200x400 xc:transparent \
            -font Arial -pointsize 70 -fill '#38BDAE' -gravity center \
            -annotate 0 'Likhon Sheikh' \
            -font Arial -pointsize 40 -fill '#FFFFFF' -gravity center \
            -annotate +0+80 'Full Stack Developer | Open Source Innovator' \
            banners/dynamic-banner.png

      - name: 📤 Deploy Visuals
        uses: crazy-max/ghaction-github-pages@v3
        with:
          target_branch: output
          build_dir: |
            dist
            banners
        env:
          GITHUB_TOKEN: ${{ env.GH_TOKEN }}

  quality-and-analytics:
    name: 🔬 Advanced Code Quality & Insights
    runs-on: ubuntu-latest
    steps:
      - name: 🔄 Checkout Repository
        uses: actions/checkout@v4

      - name: 🔍 Code Quality Analysis
        uses: github/codeql-action/analyze@v2

      - name: 📊 Additional Insights
        uses: lowlighter/metrics@latest
        with:
          token: ${{ env.METRICS_TOKEN }}
          base: ""
          plugin_lines: yes
          plugin_discussions: yes
          plugin_stargazers: yes

  readme-auto-update:
    name: 📝 README Auto-Update
    runs-on: ubuntu-latest
    steps:
      - name: 🔄 Checkout Repository
        uses: actions/checkout@v4

      - name: 🛠️ Generate README
        run: |
          cat > README.md << EOF
          <div align="center">
            <img src="https://raw.githubusercontent.com/likhonisaac/likhonisaac/output/banners/dynamic-banner.png" width="100%" alt="Dynamic Banner"/>
            <a href="https://git.io/typing-svg">
              <img src="https://readme-typing-svg.demolab.com?font=Fira+Code&pause=1000&color=38BDAE&center=true&width=600&lines=🚀+Transforming+Ideas+into+Digital+Solutions;💻+Crafting+Scalable+Applications;🌐+Exploring+Cutting-Edge+Technologies" alt="Typing SVG" />
            </a>
            <img src="https://github-readme-stats.vercel.app/api?username=likhonisaac&show_icons=true&theme=radical&hide_border=true" width="49%"/>
            <img src="https://github-readme-streak-stats.herokuapp.com/?user=likhonisaac&theme=radical" width="49%"/>
            <img src="https://skillicons.dev/icons?i=js,ts,python,go,react,vue,nodejs,docker,kubernetes,aws" alt="Tech Stack"/>
            <img src="https://raw.githubusercontent.com/likhonisaac/likhonisaac/output/snake-dark.svg" alt="Snake Animation"/>
            <img src="https://github-profile-trophy.vercel.app/?username=likhonisaac&theme=radical&no-frame=true" alt="Achievements"/>
            <p>
              <a href="https://t.me/RektDevelopers">
                <img src="https://img.shields.io/badge/Telegram-2CA5E0?style=for-the-badge&logo=telegram&logoColor=white" alt="Telegram"/>
              </a>
              <a href="https://likhon.xyz">
                <img src="https://img.shields.io/badge/Portfolio-38BDAE?style=for-the-badge&logo=web&logoColor=white" alt="Portfolio"/>
              </a>
            </p>
            <img src="https://komarev.com/ghpvc/?username=likhonisaac&style=for-the-badge&color=38BDAE" alt="Profile Views"/>
          </div>
          EOF

      - name: 📤 Commit README Updates
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "<>"
          git add README.md
          git commit -m "🤖 Auto-update README with latest metrics" || exit 0
          git push
